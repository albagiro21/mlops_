services:
  mlflow:
    build: ./services/mlflow
    ports:
      - "${MLFLOW_PORT}:5000"
    volumes:
      - mlflow_data:/mlflow
    environment:
      - MLFLOW_TRACKING_URI=http://0.0.0.0:5000

  api:
    build: ./services/api
    ports:
      - "${API_PORT}:8000"
    environment:
      - MLFLOW_TRACKING_URI=http://mlflow:5000
      - MODEL_NAME=demo-model
      - MODEL_STAGE=Production
    depends_on:
      - mlflow
  training:
    build: ./services/training
    environment:
      - MLFLOW_TRACKING_URI=http://mlflow:5000
    depends_on:
      - mlflow
volumes:
  mlflow_data: